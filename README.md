# F*cking DingTalk & The Morning Star Plan

## 我为什么要写这个B玩意儿

因为钉钉的自动报表导出和这个晨曦计划，都是一坨屎。

-   **钉钉的报表**：但凡脑子正常一点的人，都设计不出这种反人类的Excel表格。合并单元格和扭曲诡异的故意恶心人的表格结构，让我相思。导出的数据里还藏着些看不见的特殊字符，专门用来搞人心态。
-   **晨曦计划**：一个听起来很美的名字，背后是各种烦人的规则。早晚自习时长要求不一样，还得每周统计，跟综测挂钩。

作为副班长我不想每周都浪费生命在这种破事上。所以，在一个晚上，我写了这个脚本来解决统计问题。


## 怎么用

整个流程很简单：

1.  **准备环境**:
    * 电脑上得有Python。
    * 命令行里跑一下 `pip install pandas openpyxl` 把要用的库装好。

2.  **准备文件**:
    * **`学生名单.csv`**: 你得自己创建一个，里面就两列，表头是`姓名`和`学号`。
    * **最新的考勤Excel**: 从钉钉把它下载下来。
    * **脚本文件**: 把 `晨曦计划脚本.py` 和上面两个文件放同一个文件夹里。

3.  **运行**:
    * 直接双击运行 `.py` 文件，或者在文件夹里开命令行跑 `python 晨曦计划脚本.py`。
    * 搞定。文件夹里会多出来一个最新的Excel统计表和一个Markdown周报。

##  实现逻辑

核心就三步：

1. 它会忽略掉报表前几行没用的废话，直接找到第4行那个真正的标题行，把数据读进去。

2. 钉钉给的表格是 `学生x日期` 的矩阵格式，很难用。脚本会用一个叫 `melt` 的操作，把它强行转换成一个简单的流水账列表，每一行就是一次打卡记录。

3.  把表格“捏”好之后，剩下的事就简单了。脚本会：
    * 遍历每一条打卡记录，根据时间（6-12点算早上，18-23点算晚上）给它们打上“早自习”或“晚自习”的标签。
    * 把每个人的记录分组，计算每次自习的起止时间和总时长。
    * 根据晨曦计划的SB规则（早上≥45分钟，晚上≥60分钟），判断每次打卡是否有效。
    * 最后，把所有有效和无效的记录分开，统计总数，生成那两个报告文件。

基本上，它就是把你每周需要手动做的所有恶心人的步骤，毫无人性地重复了一遍，但速度快一万倍。
